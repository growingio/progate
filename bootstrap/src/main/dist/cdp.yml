app: graphql-gateway
units:
  - name: graphql-gateway
    ports:
      - name: jmx_exporter
        protocol: http
      - name: http
        protocol: http
      - name: grpc
        protocol: grpc
    command: "{{ app_deploy_dir}}/bin/bootstrap"
    envs:
      JAVA_OPTS: -javaagent:{{ jmx_jar_path }}={{ services.graphql_gateway.jmx_exporter.port }}:{{ app_deploy_dir }}/conf/metrics.yml
        {% if global.elastic_apm.enabled %}
        -javaagent:{{ elastic_apm_agent_jar_path }}
        -Delastic.apm.service_name=olap-server
        -Delastic.apm.server_urls={{ global.elastic_apm.server_urls }}
        -Delastic.apm.secret_token={{ global.elastic_apm.secret_token }}
        -Delastic.apm.environment={{ global.elastic_apm.environment }}
        -Delastic.apm.application_packages=io.growing.olap
        {% endif %}
resources:
  - resource: redis
    name: graphql_gateway

configs:
  - path: conf/application.yaml.tpl
  - path: conf/log4j2-spring.xml.tpl
  - path: conf/application.conf.tpl
  - path: conf/metrics.yml

custom_configs:
  - name: cache_enabled
    default: true
  - name: olap_pool
    default: qs
